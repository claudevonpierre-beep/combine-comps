<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NFL Combine Comparables — 2026 Draft Class</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --black: #0d0d0d;
    --dark:  #111111;
    --card:  #1a1a1a;
    --border:#2a2a2a;
    --green: #39FF14;
    --green2:#2bcc10;
    --white: #ffffff;
    --muted: #666666;
    --gold:  #c9a84c;
  }
  body { background: var(--black); color: var(--white); font-family: Arial, sans-serif; min-height: 100vh; }

  /* HEADER */
  header {
    background: var(--dark);
    border-bottom: 3px solid var(--green);
    padding: 24px 40px;
    display: flex; align-items: flex-end; gap: 20px;
  }
  .header-eyebrow { font-size: 10px; letter-spacing: 4px; color: var(--green); text-transform: uppercase; font-weight: 900; margin-bottom: 4px; }
  .header-title   { font-size: 28px; font-weight: 900; font-family: 'Arial Black', Arial; letter-spacing: -0.5px; }
  .header-sub     { font-size: 13px; color: var(--muted); margin-top: 3px; }
  .header-badge   { margin-left: auto; background: var(--green); color: var(--black); font-size: 11px; font-weight: 900; padding: 6px 14px; letter-spacing: 1px; white-space: nowrap; }

  /* MAIN */
  main { max-width: 1100px; margin: 0 auto; padding: 32px 24px; }

  /* SELECT PANEL */
  .select-panel {
    background: var(--dark);
    border: 1px solid var(--border);
    padding: 28px 32px;
    margin-bottom: 32px;
  }
  .panel-title { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--green); font-weight: 900; margin-bottom: 20px; }
  .controls { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 16px; align-items: end; }
  label { font-size: 11px; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; color: var(--muted); display: block; margin-bottom: 6px; }
  select, input[type=number], input[type=text] {
    width: 100%; background: #0a0a0a; border: 1px solid var(--border);
    color: var(--white); padding: 10px 12px; font-size: 14px; font-family: Arial;
    outline: none; appearance: none;
  }
  select:focus, input:focus { border-color: var(--green); }
  .run-btn {
    background: var(--green); color: var(--black); border: none;
    padding: 11px 28px; font-size: 13px; font-weight: 900; letter-spacing: 2px;
    text-transform: uppercase; cursor: pointer; white-space: nowrap; font-family: Arial;
  }
  .run-btn:hover { background: var(--green2); }

  /* MANUAL INPUT */
  .manual-grid {
    display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px;
    margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border);
  }
  .manual-grid label { color: var(--muted); }
  .manual-grid input { font-size: 13px; }
  .input-hint { font-size: 10px; color: #444; margin-top: 3px; }

  /* PROSPECT CARD */
  .prospect-card {
    background: var(--dark); border-left: 4px solid var(--green);
    padding: 20px 24px; margin-bottom: 24px;
    display: flex; gap: 32px; align-items: flex-start; flex-wrap: wrap;
  }
  .prospect-name  { font-size: 22px; font-weight: 900; font-family: 'Arial Black', Arial; margin-bottom: 2px; }
  .prospect-meta  { font-size: 12px; color: var(--muted); margin-bottom: 12px; }
  .prospect-pos   { display: inline-block; background: var(--green); color: var(--black); font-size: 10px; font-weight: 900; padding: 3px 10px; letter-spacing: 2px; margin-bottom: 12px; }
  .measurements { display: flex; gap: 20px; flex-wrap: wrap; }
  .meas-item { text-align: center; }
  .meas-val  { font-size: 22px; font-weight: 900; color: var(--green); font-family: 'Arial Black', Arial; line-height: 1; }
  .meas-lbl  { font-size: 10px; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; margin-top: 2px; }

  /* RESULTS SECTION */
  .results-label { font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--muted); font-weight: 900; margin-bottom: 16px; }
  .comp-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; }

  .comp-card {
    background: var(--card); border: 1px solid var(--border);
    padding: 18px 20px; position: relative;
    transition: border-color 0.15s;
  }
  .comp-card:hover { border-color: #444; }
  .comp-rank {
    position: absolute; top: 12px; right: 14px;
    font-size: 28px; font-weight: 900; color: var(--border);
    font-family: 'Arial Black', Arial; line-height: 1;
  }
  .comp-name { font-size: 16px; font-weight: 900; margin-bottom: 2px; }
  .comp-meta { font-size: 11px; color: var(--muted); margin-bottom: 12px; }
  .comp-draft {
    display: inline-flex; align-items: center; gap: 8px;
    margin-bottom: 14px;
  }
  .draft-badge {
    font-size: 11px; font-weight: 900; padding: 3px 10px;
    letter-spacing: 1px; text-transform: uppercase;
  }
  .round-1  { background: var(--gold); color: var(--black); }
  .round-2  { background: #888; color: var(--black); }
  .round-3  { background: #555; color: var(--white); }
  .round-4+ { background: var(--border); color: var(--muted); }
  .udfa     { background: var(--black); color: var(--muted); border: 1px solid var(--border); }
  .draft-yr { font-size: 11px; color: var(--muted); }

  .comp-measurements { display: flex; gap: 12px; flex-wrap: wrap; }
  .cm-item { }
  .cm-val  { font-size: 14px; font-weight: 700; }
  .cm-lbl  { font-size: 9px; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; }
  .cm-diff-pos { color: #4CAF50; font-size: 10px; }
  .cm-diff-neg { color: #e24a4a; font-size: 10px; }
  .cm-diff-neu { color: var(--muted); font-size: 10px; }

  .similarity-bar-wrap { margin-top: 12px; }
  .sim-label { font-size: 10px; color: var(--muted); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 4px; }
  .sim-bar-bg { background: var(--border); height: 4px; border-radius: 2px; }
  .sim-bar    { background: var(--green); height: 4px; border-radius: 2px; transition: width 0.4s; }

  /* STATUS / LOADING */
  .status { padding: 60px; text-align: center; color: var(--muted); font-size: 15px; }
  .spinner-wrap { display: flex; align-items: center; justify-content: center; gap: 12px; }
  .spinner { width: 20px; height: 20px; border: 2px solid var(--border); border-top-color: var(--green); border-radius: 50%; animation: spin 0.8s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* LEGEND */
  .legend { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 20px; }
  .legend-item { display: flex; align-items: center; gap: 6px; font-size: 11px; color: var(--muted); }
  .lb { width: 14px; height: 14px; font-size: 9px; font-weight: 900; display: flex; align-items: center; justify-content: center; }

  /* EMPTY STATE */
  .no-results { color: var(--muted); font-size: 14px; padding: 24px 0; }
  .update-note { font-size: 11px; color: #444; margin-top: 24px; padding: 12px 16px; border: 1px dashed #333; }

  @media (max-width: 700px) {
    .controls { grid-template-columns: 1fr 1fr; }
    .manual-grid { grid-template-columns: repeat(3,1fr); }
    header { padding: 20px; }
    main { padding: 20px 16px; }
  }
</style>
</head>
<body>

<header>
  <div>
    <div class="header-eyebrow">The 33rd Team</div>
    <div class="header-title">Combine Comparables Engine</div>
    <div class="header-sub">Find the 10 most athletically similar players in NFL draft history · DJ Top 50 v2.0 loaded</div>
  </div>
  <div class="header-badge">2026 NFL DRAFT</div>
</header>

<main>

  <!-- SELECT PANEL -->
  <div class="select-panel">
    <div class="panel-title">Select Prospect or Enter Measurements</div>
    <div class="controls">
      <div>
        <label>2026 Prospect</label>
        <select id="prospect-select" onchange="onProspectSelect()">
          <option value="">— or enter manually below —</option>
        </select>
      </div>
      <div>
        <label>Position Group</label>
        <select id="pos-filter">
          <option value="">All Positions</option>
          <option value="QB">QB</option>
          <option value="RB">RB</option>
          <option value="WR">WR</option>
          <option value="TE">TE</option>
          <option value="OL">OL</option>
          <option value="EDGE">EDGE</option>
          <option value="DT">DT</option>
          <option value="LB">LB</option>
          <option value="CB">CB</option>
          <option value="S">S</option>
        </select>
      </div>
      <div>
        <label>Top N Comps</label>
        <select id="top-n">
          <option value="10" selected>10</option>
          <option value="15">15</option>
          <option value="20">20</option>
        </select>
      </div>
      <button class="run-btn" onclick="runComps()">Find Comps</button>
    </div>

    <!-- Manual inputs -->
    <div class="manual-grid">
      <div>
        <label>Height (in)</label>
        <input type="number" id="m-height" placeholder="e.g. 73" step="1" min="60" max="84">
        <div class="input-hint">6'1" = 73</div>
      </div>
      <div>
        <label>Weight (lbs)</label>
        <input type="number" id="m-weight" placeholder="e.g. 218" step="1">
      </div>
      <div>
        <label>40 Time</label>
        <input type="number" id="m-forty" placeholder="e.g. 4.38" step="0.01" min="4.0" max="6.0">
      </div>
      <div>
        <label>Vertical (in)</label>
        <input type="number" id="m-vertical" placeholder="e.g. 39.5" step="0.5">
      </div>
      <div>
        <label>Broad Jump (in)</label>
        <input type="number" id="m-broad" placeholder="e.g. 130" step="1">
      </div>
      <div>
        <label>3-Cone</label>
        <input type="number" id="m-cone" placeholder="e.g. 6.89" step="0.01">
      </div>
      <div>
        <label>Shuttle</label>
        <input type="number" id="m-shuttle" placeholder="e.g. 4.14" step="0.01">
      </div>
    </div>
  </div>

  <!-- RESULTS -->
  <div id="results-area">
    <div class="status">Select a prospect or enter measurements to find historical comps.</div>
  </div>

</main>

<script>
// ─── Data ────────────────────────────────────────────────────────────────────
let HIST = [];
let PROSPECTS = [];
let NORMS = {};   // position group → { metric → {mean, std} }

// ─── Weights per metric (higher = more important) ─────────────────────────
const WEIGHTS = { f: 0.30, h: 0.15, w: 0.15, v: 0.15, b: 0.12, c: 0.08, sh: 0.05 };
// Note: for cone/shuttle, lower is better — we'll flip when computing diff

// ─── Load data ────────────────────────────────────────────────────────────
async function loadData() {
  document.getElementById('results-area').innerHTML =
    '<div class="status"><div class="spinner-wrap"><div class="spinner"></div> Loading combine database...</div></div>';

  try {
    const [histRes, proRes] = await Promise.all([
      fetch('hist_compact.json'),
      fetch('prospects_2026.json'),
    ]);
    HIST = await histRes.json();
    PROSPECTS = await proRes.json();
    computeNorms();
    populateProspectDropdown();
    document.getElementById('results-area').innerHTML =
      '<div class="status">✅ ' + HIST.length.toLocaleString() + ' historical players loaded (2000–2025). Select a prospect or enter measurements.</div>';
  } catch(e) {
    document.getElementById('results-area').innerHTML =
      '<div class="status">⚠ Failed to load data: ' + e.message + '</div>';
  }
}

// ─── Compute per-position z-score normalization params ────────────────────
function computeNorms() {
  const groups = {};
  for (const r of HIST) {
    const pg = r.pg || 'ALL';
    if (!groups[pg]) groups[pg] = { f:[], h:[], w:[], v:[], b:[], c:[], sh:[] };
    for (const k of ['f','h','w','v','b','c','sh']) {
      if (r[k] != null) groups[pg][k].push(r[k]);
    }
  }
  for (const [pg, metrics] of Object.entries(groups)) {
    NORMS[pg] = {};
    for (const [k, vals] of Object.entries(metrics)) {
      if (vals.length < 2) { NORMS[pg][k] = { mean: 0, std: 1 }; continue; }
      const mean = vals.reduce((a,b)=>a+b,0) / vals.length;
      const std  = Math.sqrt(vals.reduce((a,b)=>a+(b-mean)**2,0) / vals.length) || 1;
      NORMS[pg][k] = { mean, std };
    }
  }
}

function normalize(val, pg, key) {
  const n = (NORMS[pg] || NORMS['WR'] || {})[key];
  if (!n) return 0;
  return (val - n.mean) / n.std;
}

// ─── Prospect dropdown ────────────────────────────────────────────────────
function populateProspectDropdown() {
  const sel = document.getElementById('prospect-select');

  // Sort by DJ rank if present, then group by position
  const sorted = [...PROSPECTS].sort((a, b) => {
    if (a.dj_rank && b.dj_rank) return a.dj_rank - b.dj_rank;
    if (a.dj_rank) return -1;
    if (b.dj_rank) return 1;
    return 0;
  });

  // Two groups: DJ Top 50, then everything else by position
  const djGrp = document.createElement('optgroup');
  djGrp.label = '── DJ Top 50 (2.0) ──';
  for (const p of sorted.filter(p => p.dj_rank)) {
    const opt = document.createElement('option');
    opt.value = PROSPECTS.indexOf(p);
    const hasMeasurements = p.forty || p.vertical || p.broad_jump;
    const rankStr = p.dj_rank ? `#${p.dj_rank} ` : '';
    opt.textContent = rankStr + p.name + ' — ' + p.pos + ' — ' + p.school + (hasMeasurements ? ' ✓' : '');
    djGrp.appendChild(opt);
  }
  sel.appendChild(djGrp);

  const otherProspects = sorted.filter(p => !p.dj_rank);
  if (otherProspects.length) {
    const otherGrp = document.createElement('optgroup');
    otherGrp.label = '── Other Prospects ──';
    for (const p of otherProspects) {
      const opt = document.createElement('option');
      opt.value = PROSPECTS.indexOf(p);
      const hasMeasurements = p.forty || p.vertical || p.broad_jump;
      opt.textContent = p.name + ' — ' + p.pos + ' — ' + p.school + (hasMeasurements ? ' ✓' : '');
      otherGrp.appendChild(opt);
    }
    sel.appendChild(otherGrp);
  }
}

function onProspectSelect() {
  const idx = document.getElementById('prospect-select').value;
  if (idx === '') {
    clearManual();
    return;
  }
  const p = PROSPECTS[parseInt(idx)];
  // Set position filter
  document.getElementById('pos-filter').value = p.pos_group;
  // Fill manual fields
  setField('m-height',  p.height_in);
  setField('m-weight',  p.weight);
  setField('m-forty',   p.forty);
  setField('m-vertical',p.vertical);
  setField('m-broad',   p.broad_jump);
  setField('m-cone',    p.cone);
  setField('m-shuttle', p.shuttle);
}

function setField(id, val) {
  document.getElementById(id).value = val != null ? val : '';
}
function clearManual() {
  ['m-height','m-weight','m-forty','m-vertical','m-broad','m-cone','m-shuttle']
    .forEach(id => document.getElementById(id).value = '');
}

// ─── Run comps ────────────────────────────────────────────────────────────
function runComps() {
  const prosIdx   = document.getElementById('prospect-select').value;
  const posFilter = document.getElementById('pos-filter').value;
  const topN      = parseInt(document.getElementById('top-n').value);

  // Gather query measurements
  const query = {
    h:  getNum('m-height'),
    w:  getNum('m-weight'),
    f:  getNum('m-forty'),
    v:  getNum('m-vertical'),
    b:  getNum('m-broad'),
    c:  getNum('m-cone'),
    sh: getNum('m-shuttle'),
  };

  const hasAny = Object.values(query).some(v => v != null);
  if (!hasAny) {
    alert('Enter at least one measurement.');
    return;
  }

  // Determine position group for normalization
  const pg = posFilter || 'WR';  // fallback

  // Compute similarity vs all historical players
  let candidates = HIST.filter(r => {
    if (posFilter && r.pg !== posFilter) return false;
    // Must have at least one overlapping metric with query
    return Object.keys(query).some(k => query[k] != null && r[k] != null);
  });

  const scored = candidates.map(r => {
    let weightSum = 0, distSq = 0;
    for (const [k, w] of Object.entries(WEIGHTS)) {
      if (query[k] == null || r[k] == null) continue;
      const qn = normalize(query[k], pg, k);
      const rn = normalize(r[k], pg, k);
      distSq += w * (qn - rn) ** 2;
      weightSum += w;
    }
    if (weightSum === 0) return null;
    const dist = Math.sqrt(distSq / weightSum);
    return { ...r, dist, weightSum };
  }).filter(Boolean);

  scored.sort((a, b) => a.dist - b.dist);
  const top = scored.slice(0, topN);

  // Prospect info
  let prospect = null;
  if (prosIdx !== '') prospect = PROSPECTS[parseInt(prosIdx)];

  renderResults(prospect, query, pg, top, posFilter, topN);
}

function getNum(id) {
  const v = parseFloat(document.getElementById(id).value);
  return isNaN(v) ? null : v;
}

// ─── Render ────────────────────────────────────────────────────────────────
function renderResults(prospect, query, pg, comps, posFilter, topN) {
  const area = document.getElementById('results-area');

  let html = '';

  // Prospect card
  if (prospect) {
    const posLabel = prospect.pos;
    const djBadge = prospect.dj_rank ? `<span style="background:#222;border:1px solid var(--green);color:var(--green);font-size:10px;font-weight:900;padding:3px 10px;letter-spacing:2px;margin-right:8px;">DJ #${prospect.dj_rank}</span>` : '';
    html += `<div class="prospect-card">
      <div>
        <div style="margin-bottom:8px">${djBadge}<span class="prospect-pos" style="display:inline-block">${posLabel}</span></div>
        <div class="prospect-name">${prospect.name}</div>
        <div class="prospect-meta">${prospect.school} · 2026 NFL Draft${prospect.note ? ' · ' + prospect.note : ''}</div>
      </div>
      <div class="measurements">
        ${mitem(fmtHt(query.h), 'Height')}
        ${mitem(query.w ? query.w + ' lbs' : '—', 'Weight')}
        ${mitem(query.f ? query.f.toFixed(2) : '—', '40 Time')}
        ${mitem(query.v ? query.v.toFixed(1) + '"' : '—', 'Vertical')}
        ${mitem(query.b ? query.b + '"' : '—', 'Broad Jump')}
        ${mitem(query.c ? query.c.toFixed(2) : '—', '3-Cone')}
        ${mitem(query.sh ? query.sh.toFixed(2) : '—', 'Shuttle')}
      </div>
    </div>`;
  }

  // Results
  const maxDist = comps.length ? comps[comps.length - 1].dist : 1;

  html += `<div class="results-label">Top ${comps.length} Historical Athletic Comps${posFilter ? ' — ' + posFilter : ''} (2000–2025)</div>`;

  if (!comps.length) {
    html += '<div class="no-results">No comps found. Try adding more measurements or changing the position filter.</div>';
  } else {
    html += '<div class="comp-grid">';
    comps.forEach((c, i) => {
      const simPct = Math.round((1 - c.dist / (maxDist + 0.001)) * 100);
      const draftBadge = draftLabel(c);
      const draftClass = draftBadgeClass(c);

      html += `<div class="comp-card">
        <div class="comp-rank">#${i+1}</div>
        <div class="comp-name">${c.n}</div>
        <div class="comp-meta">${c.p} · ${c.s} · ${c.cy || '?'}</div>
        <div class="comp-draft">
          <span class="draft-badge ${draftClass}">${draftBadge}</span>
          <span class="draft-yr">${c.dy ? c.dy + ' Draft' : 'Undrafted'}</span>
        </div>
        <div class="comp-measurements">
          ${cmItem(c.h, query.h, fmtHt(c.h), 'Height', false)}
          ${cmItem(c.w, query.w, c.w ? c.w + ' lbs' : null, 'Weight', false)}
          ${cmItem(c.f, query.f, c.f ? c.f.toFixed(2) : null, '40', true)}
          ${cmItem(c.v, query.v, c.v ? c.v.toFixed(1) + '"' : null, 'Vert', false)}
          ${cmItem(c.b, query.b, c.b ? c.b + '"' : null, 'Broad', false)}
          ${cmItem(c.c, query.c, c.c ? c.c.toFixed(2) : null, 'Cone', true)}
          ${cmItem(c.sh, query.sh, c.sh ? c.sh.toFixed(2) : null, 'Shuttle', true)}
        </div>
        <div class="similarity-bar-wrap">
          <div class="sim-label">Similarity</div>
          <div class="sim-bar-bg"><div class="sim-bar" style="width:${simPct}%"></div></div>
        </div>
      </div>`;
    });
    html += '</div>';
  }

  html += `<div class="update-note">
    ⚠ 2026 combine measurements are updating throughout the week (Feb 24 – Mar 3).
    Open <code>prospects_2026.json</code> to add results as they post.
    Missing measurements are handled gracefully — comps use whatever's available.
  </div>`;

  area.innerHTML = html;
}

function mitem(val, label) {
  return `<div class="meas-item"><div class="meas-val">${val || '—'}</div><div class="meas-lbl">${label}</div></div>`;
}

function cmItem(compVal, queryVal, display, label, lowerBetter) {
  if (!display) return `<div class="cm-item"><div class="cm-val" style="color:#333">—</div><div class="cm-lbl">${label}</div></div>`;
  let diffHtml = '';
  if (queryVal != null && compVal != null) {
    const diff = compVal - queryVal;
    const better = lowerBetter ? diff < 0 : diff > 0;
    const sign = diff > 0 ? '+' : '';
    const cls = diff === 0 ? 'cm-diff-neu' : (better ? 'cm-diff-pos' : 'cm-diff-neg');
    const d = Math.abs(diff) < 0.005 ? '≈' : sign + diff.toFixed(2);
    diffHtml = `<div class="${cls}">${d}</div>`;
  }
  return `<div class="cm-item"><div class="cm-val">${display}</div><div class="cm-lbl">${label}</div>${diffHtml}</div>`;
}

function fmtHt(inches) {
  if (!inches) return null;
  const ft = Math.floor(inches / 12);
  const i  = inches % 12;
  return `${ft}'${i}"`;
}

function draftLabel(c) {
  if (!c.dr) return 'UDFA';
  if (c.dp) return `Rd ${c.dr}, Pick ${c.dp}`;
  return `Round ${c.dr}`;
}

function draftBadgeClass(c) {
  if (!c.dr) return 'udfa';
  if (c.dr === 1) return 'round-1';
  if (c.dr === 2) return 'round-2';
  if (c.dr === 3) return 'round-3';
  return 'round-4+';
}

// ─── Init ─────────────────────────────────────────────────────────────────
loadData();
</script>
</body>
</html>
